{"version":3,"sources":["Player.js"],"names":["cc","Class","extends","Component","properties","spineboy","sp","Skeleton","hpBar","ProgressBar","heath","onLoad","node","getComponent","setAnimation","isDeath","start","attack","getHit","duration","damage","die","action","sequence","delayTime","spawn","callFunc","flash","tween","to","progress","runAction","color","Color","RED","WHITE","repeat","call","clearTracks","checkDeath","setCompleteListener","entry","animation","name","update","dt"],"mappings":"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","file":"Player.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        spineboy: sp.Skeleton,\n        hpBar: cc.ProgressBar,\n        heath: 1\n    },\n    onLoad() {\n        this.spineboy = this.node.getComponent(sp.Skeleton);\n        this.spineboy.setAnimation(0, \"idle\", true);\n        this.isDeath=null;\n    },\n    start() {\n        //this.die(0.5);\n    },\n    attack() {\n        this.spineboy.setAnimation(1, 'shoot', false);\n        //this.spineboy.setAnimation(0, \"idle\", true);\n    },\n    getHit(duration, damage) {\n        this.heath -= damage\n        if (this.heath < 0) {\n            this.heath = 0;\n            this.die(duration);\n        } else {\n            let action = cc.sequence(\n                cc.delayTime(0.7),\n                cc.spawn(\n                    cc.callFunc(() => this.flash(duration)),\n                    cc.callFunc(() => {\n                        cc.tween(this.hpBar)\n                            .to(duration, { progress: this.heath })\n                            .start()\n                    }),\n                    cc.callFunc(() => {\n                        this.spineboy.setAnimation(1, \"run-to-idle\", false);\n                    }),\n                )\n            )\n\n            this.node.runAction(action);\n        }\n    },\n    flash(duration) {\n        let action = cc.sequence(\n            cc.callFunc(() => {\n                this.node.color = cc.Color.RED;\n            }),\n            cc.delayTime(duration / 6),\n            cc.callFunc(() => {\n                this.node.color = cc.Color.WHITE;\n            }),\n            cc.delayTime(duration / 6),\n        ).repeat(3)\n        this.node.runAction(action)\n    },\n    die(duration) {\n        this.isDeath = false;\n        let action = cc.callFunc(() => {\n            cc.tween(this.hpBar)\n                .to(duration, { progress: 0 })\n                .call(() => {\n                    this.spineboy.clearTracks();\n                    this.spineboy.setAnimation(0, \"death\", false);\n                })\n                .start()\n        })\n        this.node.runAction(action);\n\n    },\n    checkDeath() {\n        this.spineboy.setCompleteListener((entry) => {\n            if (entry.animation.name == \"death\") {\n                return true;\n            }\n            return false;\n        })\n    },\n    update(dt) {\n        if (this.isDeath == false) {\n            this.spineboy.setCompleteListener((entry) => {\n                if (entry.animation.name == \"death\") {\n                    this.isDeath=true;\n                }\n            })\n        }\n    }\n});\n"]}